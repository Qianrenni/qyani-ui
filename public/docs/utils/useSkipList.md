# `UseSkipList<T>` è·³è¡¨æ•°æ®ç»“æ„æ–‡æ¡£

## ç±»å®šä¹‰

```ts
class UseSkipList<T>
```

è·³è¡¨ï¼ˆSkip Listï¼‰æ˜¯ä¸€ç§åŸºäºæ¦‚ç‡çš„å¤šå±‚çº§é“¾è¡¨æ•°æ®ç»“æ„ï¼Œæ”¯æŒåœ¨ $ O(\log n) $ å¹³å‡æ—¶é—´å¤æ‚åº¦å†…å®Œæˆæ’å…¥ã€åˆ é™¤å’ŒæŸ¥æ‰¾æ“ä½œã€‚é€‚ç”¨äºæœ‰åºé›†åˆçš„é«˜æ•ˆç»´æŠ¤ã€‚

---

## æ„é€ å‡½æ•°

```ts
constructor(threadSafe: boolean = false, P: number = 0.25, MAX_LEVEL: number = 32)
```

### å‚æ•°

| å‚æ•°         | ç±»å‹      | é»˜è®¤å€¼   | å¿…å¡« | è¯´æ˜ |
|------------|---------|-------|----|------|
| `threadSafe` | `boolean` | `false` | å¦  | æ˜¯å¦å¯ç”¨çº¿ç¨‹å®‰å…¨ï¼ˆå½“å‰å®ç°æœªå®ç°çº¿ç¨‹å®‰å…¨ï¼‰ |
| `P`        | `number`  | `0.25`  | å¦  | éšæœºæ™‹å‡æ¦‚ç‡ï¼Œæ§åˆ¶èŠ‚ç‚¹å‡å±‚çš„æ¦‚ç‡ |
| `MAX_LEVEL`| `number`  | `32`    | å¦  | è·³è¡¨æœ€å¤§å…è®¸å±‚çº§ |

> ğŸ“Œ ç¤ºä¾‹ï¼šåˆ›å»ºä¸€ä¸ªè·³è¡¨å®ä¾‹
> ```ts
> const skipList = new UseSkipList<string>(false, 0.25, 16);
> ```

---

## å±æ€§ï¼ˆåªè¯»ï¼‰

| å±æ€§       | ç±»å‹     | è¯´æ˜ |
|----------|--------|------|
| `length` | `number` | å½“å‰è·³è¡¨ä¸­å…ƒç´ çš„æ•°é‡ï¼ˆé€šè¿‡ getter è®¿é—®ï¼‰ |

---

## æ–¹æ³•

### `insert(score: number, member: T): boolean`

æ’å…¥ä¸€ä¸ªæ–°å…ƒç´ åˆ°è·³è¡¨ä¸­ï¼ŒæŒ‰ `score` æ’åºï¼Œè‹¥åˆ†æ•°ç›¸åŒåˆ™æŒ‰ `member` æ¯”è¾ƒã€‚

#### å‚æ•°

| å‚æ•°      | ç±»å‹      | è¯´æ˜ |
|---------|---------|------|
| `score` | `number` | å…ƒç´ çš„æ’åºåˆ†æ•° |
| `member`| `T`      | å­˜å‚¨çš„æ•°æ®å†…å®¹ |

#### è¿”å›å€¼

- `true`ï¼šæ’å…¥æˆåŠŸ
- `false`ï¼šå…ƒç´ å·²å­˜åœ¨ï¼ˆåˆ†æ•°ä¸æˆå‘˜å®Œå…¨ç›¸åŒï¼‰

---

### `delete(score: number, member: T): boolean`

ä»è·³è¡¨ä¸­åˆ é™¤æŒ‡å®šå…ƒç´ ã€‚

#### å‚æ•°

| å‚æ•°      | ç±»å‹      | è¯´æ˜ |
|---------|---------|------|
| `score` | `number` | å¾…åˆ é™¤å…ƒç´ çš„åˆ†æ•° |
| `member`| `T`      | å¾…åˆ é™¤å…ƒç´ çš„æ•°æ® |

#### è¿”å›å€¼

- `true`ï¼šåˆ é™¤æˆåŠŸ
- `false`ï¼šå…ƒç´ ä¸å­˜åœ¨

---

### `get_by_rank(rank: number): [number, T] \| null`

æ ¹æ®æ’åè·å–å¯¹åº”çš„å…ƒç´ ï¼ˆæ’åä» 0 å¼€å§‹ï¼‰ã€‚

#### å‚æ•°

| å‚æ•°    | ç±»å‹      | è¯´æ˜ |
|-------|---------|------|
| `rank`| `number` | å…ƒç´ çš„æ’åï¼ˆ0-basedï¼‰ |

#### è¿”å›å€¼

- `[score: number, member: T]`ï¼šæ‰¾åˆ°çš„å…ƒç´ 
- `null`ï¼šæ’åæ— æ•ˆæˆ–è·³è¡¨ä¸ºç©º

---

### `get_rank(score: number, member: T): number \| null`

è·å–æŒ‡å®šå…ƒç´ çš„æ’åï¼ˆä» 0 å¼€å§‹ï¼‰ï¼ŒåŸºäºåˆ†æ•°å’Œæˆå‘˜å€¼ã€‚

#### å‚æ•°

| å‚æ•°      | ç±»å‹      | è¯´æ˜ |
|---------|---------|------|
| `score` | `number` | å…ƒç´ çš„åˆ†æ•° |
| `member`| `T`      | å…ƒç´ çš„æ•°æ® |

#### è¿”å›å€¼

- `number`ï¼šå…ƒç´ çš„æ’å
- `null`ï¼šå…ƒç´ ä¸å­˜åœ¨

---

### `get_first(): [number, T] \| null`

è·å–è·³è¡¨ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼ˆæœ€å°åˆ†æ•°çš„å…ƒç´ ï¼‰ã€‚

#### è¿”å›å€¼

- `[score: number, member: T]`ï¼šé¦–å…ƒç´ 
- `null`ï¼šè·³è¡¨ä¸ºç©º

---

### `get_last(): [number, T] \| null`

è·å–è·³è¡¨ä¸­çš„æœ€åä¸€ä¸ªå…ƒç´ ï¼ˆæœ€å¤§åˆ†æ•°çš„å…ƒç´ ï¼‰ã€‚

#### è¿”å›å€¼

- `[score: number, member: T]`ï¼šå°¾å…ƒç´ 
- `null`ï¼šè·³è¡¨ä¸ºç©º

---

### `range(start: number, count: number): [T, number][]`

è·å–ä» `start` å¼€å§‹çš„è¿ç»­ `count` ä¸ªå…ƒç´ ï¼ˆæ­£å‘é¡ºåºï¼‰ã€‚

#### å‚æ•°

| å‚æ•°     | ç±»å‹      | è¯´æ˜ |
|--------|---------|------|
| `start`| `number` | èµ·å§‹ä½ç½®ï¼ˆ0-basedï¼‰ |
| `count`| `number` | è·å–æ•°é‡ |

#### è¿”å›å€¼

- `Array<[T, number]>`ï¼šå…ƒç´ æ•°ç»„ï¼Œæ¯é¡¹ä¸º `[member, score]`
- ç©ºæ•°ç»„ï¼šè¶…å‡ºèŒƒå›´æˆ–å‚æ•°æ— æ•ˆ

---

### `reverse_range(start: number, count: number): [T, number][]`

è·å–ä»æœ«å°¾å¼€å§‹å€’æ•°ç¬¬ `start` ä¸ªä½ç½®èµ·çš„ `count` ä¸ªå…ƒç´ ï¼ˆé€†åºè¿”å›ï¼‰ã€‚

#### å‚æ•°

| å‚æ•°     | ç±»å‹      | è¯´æ˜ |
|--------|---------|------|
| `start`| `number` | ä»æœ«å°¾ç®—èµ·çš„ä½ç½®ï¼ˆ0-basedï¼Œå³ 0 è¡¨ç¤ºæœ€åä¸€ä¸ªï¼‰ |
| `count`| `number` | è·å–æ•°é‡ |

#### è¿”å›å€¼

- `Array<[T, number]>`ï¼šå…ƒç´ æ•°ç»„ï¼ŒæŒ‰é€†åºæ’åˆ—ï¼ˆä»é«˜åˆ†åˆ°ä½åˆ†ï¼‰
- ç©ºæ•°ç»„ï¼šè¶…å‡ºèŒƒå›´æˆ–å‚æ•°æ— æ•ˆ

---

## å†…éƒ¨æ–¹æ³•ï¼ˆç§æœ‰ï¼‰

ä»¥ä¸‹æ–¹æ³•ä»…ä¾›å†…éƒ¨ä½¿ç”¨ï¼Œä¸å¯¹å¤–æš´éœ²ï¼š

- `_randomLevel(): number`  
  æ ¹æ®æ¦‚ç‡ `P` éšæœºç”ŸæˆèŠ‚ç‚¹å±‚çº§ï¼Œæœ€å¤§ä¸è¶…è¿‡ `_MAX_LEVEL`ã€‚

- æ‰€æœ‰è·¨åº¦ï¼ˆspanï¼‰å’ŒæŒ‡é’ˆæ›´æ–°é€»è¾‘å‡å°è£…åœ¨ `insert` å’Œ `delete` ä¸­ï¼Œç¡®ä¿å¤šå±‚é“¾è¡¨ä¸€è‡´æ€§ã€‚

---

## Expose æ–¹æ³•

> âš ï¸ è¯¥ç±»æœªä½¿ç”¨ `defineExpose`ï¼ˆé Vue ç»„ä»¶ï¼‰ï¼Œå› æ­¤æ— å¯¹å¤–æš´éœ²æ–¹æ³•ã€‚

---

## æ³¨æ„äº‹é¡¹

- æ‰€æœ‰æ¯”è¾ƒåŸºäº `score` å‡åºï¼Œ`score` ç›¸åŒæ—¶ä¾æ® `member < member` åˆ¤æ–­å”¯ä¸€æ€§ã€‚
- `member` ç±»å‹éœ€æ”¯æŒ `<` æ¯”è¾ƒæ“ä½œï¼ˆå¦‚å­—ç¬¦ä¸²ã€æ•°å­—ç­‰å¯æ¯”ç±»å‹ï¼‰ã€‚
- æ’å…¥æ—¶è‹¥ `member` ä¸å¯æ¯”è¾ƒå¯èƒ½å¯¼è‡´è¡Œä¸ºå¼‚å¸¸ã€‚
- éçº¿ç¨‹å®‰å…¨ï¼Œå¤šçº¿ç¨‹ç¯å¢ƒä¸‹éœ€å¤–éƒ¨åŠ é”ã€‚

---

## å…¸å‹åº”ç”¨åœºæ™¯

- æœ‰åºé›†åˆå­˜å‚¨ï¼ˆå¦‚ Redis çš„ ZSet åº•å±‚ä¹‹ä¸€ï¼‰
- åŠ¨æ€æ’åç³»ç»Ÿ
- èŒƒå›´æŸ¥è¯¢é¢‘ç¹çš„åœºæ™¯
- æ›¿ä»£å¹³è¡¡æ ‘çš„ç®€åŒ–æ–¹æ¡ˆ

---

## æ—¶é—´å¤æ‚åº¦

| æ“ä½œ     | å¹³å‡æ—¶é—´å¤æ‚åº¦ | æœ€åæƒ…å†µ |
|--------|------------|--------|
| æ’å…¥     | $ O(\log n) $ | $ O(n) $ |
| åˆ é™¤     | $ O(\log n) $ | $ O(n) $ |
| æŸ¥æ‰¾æ’å   | $ O(\log n) $ | $ O(n) $ |
| æŒ‰æ’åè®¿é—® | $ O(\log n) $ | $ O(n) $ |

---

## å‚è€ƒèµ„æ–™

- William Pugh, "Skip Lists: A Probabilistic Alternative to Balanced Trees" (1990)